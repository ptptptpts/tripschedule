<!DOCTYPE html>
<html lang="ko" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³µìœ  ê°€ëŠ¥í•œ ì¸í„°ë™í‹°ë¸Œ ì„¸ë¶€ ê°€ì¡± ì—¬í–‰ ê°€ì´ë“œ (ë³´ì•ˆ ì˜¤ë¥˜ ìˆ˜ì •)</title>
    <!-- Chosen Palette: Serene Coast -->
    <!-- Application Structure Plan: The application is a task-oriented dashboard with a key improvement: a real-time collaborative checklist powered by Firebase. A unique 'Trip ID' is generated and used in a shareable URL, allowing multiple users to view and edit the same checklist simultaneously. This directly addresses the user's need for a shared planning tool. The structure remains user-centric (Preparation, Activities, etc.), but the 'Preparation' section is now a dynamic, multi-user component, significantly enhancing its utility for a couple planning a trip together. -->
    <!-- Visualization & Content Choices: 
        - Collaborative Checklist -> Goal: Organize/Collaborate -> Viz: Interactive HTML checklist with real-time updates -> Justification: Enables two or more users to manage a single source of truth for packing, solving the core user request. The visual feedback of seeing a partner's updates in real-time is highly engaging and practical. -> Method: Vanilla JS, Firebase Firestore, HTML/CSS.
        - eTravel/Delivery Process -> Goal: Organize -> Viz: HTML/CSS Flowchart -> Justification: Simple, visual step-by-step guides remain the most intuitive method. -> Method: HTML/CSS.
        - Payment/Transport Charts -> Goal: Inform/Compare -> Viz: Chart.js Doughnut/Bar Charts -> Justification: These static charts still provide the best at-a-glance comparison and breakdown of information. -> Library: Chart.js/Canvas.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #F8F7F4; }
        .text-brand-dark { color: #2C3E50; } .bg-brand-dark { background-color: #2C3E50; }
        .text-brand-primary { color: #3498DB; } .bg-brand-primary { background-color: #3498DB; }
        .text-brand-secondary { color: #5DADE2; } .bg-brand-secondary { background-color: #5DADE2; }
        .text-brand-accent { color: #E67E22; } .bg-brand-accent { background-color: #E67E22; }
        .bg-brand-light { background-color: #ECF0F1; }
        .chart-container { position: relative; width: 100%; max-width: 500px; margin-left: auto; margin-right: auto; height: 280px; max-height: 350px; }
        .nav-link.active { color: #E67E22; border-bottom-color: #E67E22; }
        .tab-button.active { background-color: #3498DB; color: white; }
        .checklist-item.checked label { text-decoration: line-through; color: #95a5a6; }
        #share-url { -webkit-user-select: all; user-select: all; }
    </style>
</head>
<body class="text-brand-dark">

    <header class="p-4 md:p-6 bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl md:text-2xl font-bold text-brand-primary">ì„¸ë¶€ ê°€ì¡±ì—¬í–‰ í”Œë˜ë„ˆ</h1>
            <nav id="main-nav" class="hidden md:flex space-x-6">
                <a href="#prep" class="nav-link font-semibold pb-1 border-b-2 border-transparent hover:text-brand-accent">ì¤€ë¹„</a>
                <a href="#activities" class="nav-link font-semibold pb-1 border-b-2 border-transparent hover:text-brand-accent">ì¦ê¸¸ê±°ë¦¬</a>
                <a href="#dining" class="nav-link font-semibold pb-1 border-b-2 border-transparent hover:text-brand-accent">ë¨¹ê±°ë¦¬</a>
                <a href="#safety" class="nav-link font-semibold pb-1 border-b-2 border-transparent hover:text-brand-accent">ì•ˆì „</a>
                <a href="#itinerary" class="nav-link font-semibold pb-1 border-b-2 border-transparent hover:text-brand-accent">ì¼ì •</a>
            </nav>
        </div>
    </header>

    <div class="bg-brand-primary text-white text-center py-12 px-4">
        <h2 class="text-3xl md:text-4xl font-bold">19ê°œì›” ì•„ê¸°ì™€ í•¨ê»˜í•˜ëŠ” ìƒ¹ê·¸ë¦´ë¼ ë§‰íƒ„</h2>
        <p class="mt-2 text-lg">ì‹¤ì‹œê°„ìœ¼ë¡œ í•¨ê»˜ ì¤€ë¹„í•˜ê³ , ì™„ë²½í•œ íœ´ê°€ë¥¼ ë§Œë“œì„¸ìš”.</p>
    </div>

    <main class="container mx-auto p-4 md:p-8">

        <section id="prep" class="mb-16 scroll-mt-24">
            <h3 class="text-3xl font-bold text-center mb-2">ì—¬í–‰ ì¤€ë¹„ ëŒ€ì‹œë³´ë“œ</h3>
            <p class="text-center text-gray-600 mb-8">ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ ê³µìœ í•˜ê³  í•¨ê»˜ ì¤€ë¹„ ìƒí™©ì„ í™•ì¸í•˜ì„¸ìš”.</p>
            
            <div id="share-section" class="mb-8 bg-white p-6 rounded-lg shadow-lg">
                <h4 class="text-xl font-bold mb-4 text-brand-primary">ğŸ“‹ ì´ ì—¬í–‰ ê³µìœ í•˜ê¸°</h4>
                <div id="share-loader">
                    <p class="text-gray-500">ê³µìœ  ê¸°ëŠ¥ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                </div>
                <div id="share-content" class="hidden">
                    <p class="text-gray-600 mb-4">ì•„ë˜ ë§í¬ë¥¼ ë³µì‚¬í•˜ì—¬ ì•„ë‚´ë¶„ê»˜ ë³´ë‚´ì£¼ì„¸ìš”. ë§í¬ë¥¼ í†µí•´ ì ‘ì†í•˜ë©´ ì²´í¬ë¦¬ìŠ¤íŠ¸ê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ ë™ê¸°í™”ë©ë‹ˆë‹¤.</p>
                    <div class="flex items-center space-x-4 bg-gray-100 p-2 rounded-md">
                        <input type="text" id="share-url" readonly class="w-full bg-transparent p-2 text-gray-700">
                        <button id="copy-url-btn" class="bg-brand-accent text-white font-bold py-2 px-4 rounded hover:bg-orange-600 transition">ë³µì‚¬</button>
                    </div>
                    <p id="copy-feedback" class="text-sm text-green-600 mt-2 h-4"></p>
                </div>
                 <div id="share-fallback" class="hidden">
                    <p class="text-gray-600 mb-2">í”Œë˜ë„ˆê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! ì´ ë§í¬ë¥¼ ê³µìœ í•˜ë ¤ë©´ ì•„ë˜ IDë¥¼ ë³µì‚¬í•˜ì—¬ í˜„ì¬ í˜ì´ì§€ ì£¼ì†Œ ëì— <b>?tripId=</b> ì™€ í•¨ê»˜ ë¶™ì—¬ë„£ì–´ì£¼ì„¸ìš”.</p>
                    <div id="fallback-trip-id" class="w-full bg-gray-100 p-2 rounded-md font-mono text-center text-lg cursor-pointer"></div>
                     <p id="fallback-copy-feedback" class="text-sm text-green-600 mt-2 h-4"></p>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-lg shadow-lg lg:col-span-2">
                    <h4 class="text-xl font-bold mb-4 text-brand-primary">ì‹¤ì‹œê°„ ê³µìœ  ì²´í¬ë¦¬ìŠ¤íŠ¸</h4>
                    <div id="checklist-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
                        <div id="checklist-loader" class="col-span-full text-center p-8">
                             <p class="text-gray-500">ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <h4 class="text-xl font-bold mb-4 text-brand-primary">í•„ìˆ˜ ì„œë¥˜: eTravel ë“±ë¡ ì ˆì°¨</h4>
                    <div class="space-y-4 md:space-y-0 md:flex md:items-center md:justify-between text-center">
                        <div class="flex-1"><div class="text-4xl">ğŸ“„</div><p class="font-bold mt-2">1. ì˜¨ë¼ì¸ ë“±ë¡</p><p class="text-sm text-gray-500">ì¶œë°œ 72ì‹œê°„ ì „<br>etravel.gov.ph (ë¬´ë£Œ)</p></div>
                        <div class="text-2xl text-brand-secondary hidden md:block mx-4">â†’</div><div class="text-2xl text-brand-secondary md:hidden mx-auto transform rotate-90">â†“</div>
                        <div class="flex-1"><div class="text-4xl">ğŸ“±</div><p class="font-bold mt-2">2. QR ì½”ë“œ ì €ì¥</p><p class="text-sm text-gray-500">ì´ë©”ì¼ í™•ì¸ í›„<br>íœ´ëŒ€í°ì— ìº¡ì³</p></div>
                        <div class="text-2xl text-brand-secondary hidden md:block mx-4">â†’</div><div class="text-2xl text-brand-secondary md:hidden mx-auto transform rotate-90">â†“</div>
                        <div class="flex-1"><div class="text-4xl">ğŸ›‚</div><p class="font-bold mt-2">3. ì…êµ­ ì‹¬ì‚¬</p><p class="text-sm text-gray-500">ì—¬ê¶Œê³¼ í•¨ê»˜ ì œì‹œ</p></div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <h4 class="text-xl font-bold mb-4 text-brand-primary">ê²°ì œ ì „ëµ: ì¹´ë“œì™€ í˜„ê¸ˆì˜ í™©ê¸ˆ ë¹„ìœ¨</h4>
                    <div class="chart-container" style="height:250px;"><canvas id="financeChart"></canvas></div>
                </div>
            </div>
        </section>

        <section id="activities" class="mb-16 scroll-mt-24">
             <h3 class="text-3xl font-bold text-center mb-2">ë¦¬ì¡°íŠ¸ ì¦ê¸¸ê±°ë¦¬ íƒí—˜</h3>
             <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <h4 class="text-xl font-bold mb-4 text-brand-primary">ì•ˆì „í•œ ì´ë™: ê³µí•­ êµí†µí¸ ë¹„êµ</h4>
                    <div class="chart-container"><canvas id="transportChart"></canvas></div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <h4 class="text-xl font-bold mb-4 text-brand-primary">ì•„ê¸° ë§ì¶¤ ì‹œì„¤ ì°¾ê¸°</h4>
                     <div id="activity-filters" class="flex flex-wrap justify-center gap-2 mb-6">
                        <button data-filter="all" class="filter-btn px-4 py-2 rounded-full text-sm font-semibold">ì „ì²´</button>
                        <button data-filter="water" class="filter-btn px-4 py-2 rounded-full text-sm font-semibold">ğŸ’§ ë¬¼ë†€ì´</button>
                        <button data-filter="play" class="filter-btn px-4 py-2 rounded-full text-sm font-semibold">ğŸ§¸ ì‹¤ë‚´ë†€ì´</button>
                        <button data-filter="experience" class="filter-btn px-4 py-2 rounded-full text-sm font-semibold">ğŸ  ì²´í—˜</button>
                    </div>
                    <div id="activity-cards" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
                </div>
            </div>
        </section>

        <section id="dining" class="mb-16 scroll-mt-24">
            <h3 class="text-3xl font-bold text-center mb-2">ë¨¹ê±°ë¦¬ ê°€ì´ë“œ</h3>
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <div class="flex justify-center border-b mb-6">
                    <button id="tab-resort" class="tab-button flex-1 py-2 font-semibold text-lg border-b-4 border-transparent">ë¦¬ì¡°íŠ¸</button>
                    <button id="tab-delivery" class="tab-button flex-1 py-2 font-semibold text-lg border-b-4 border-transparent">ë°°ë‹¬ìŒì‹</button>
                </div>
                <div id="content-resort" class="tab-content"></div>
                <div id="content-delivery" class="tab-content hidden"></div>
            </div>
        </section>

        <section id="safety" class="mb-16 scroll-mt-24">
            <h3 class="text-3xl font-bold text-center mb-2">ê±´ê°• & ì•ˆì „ í—ˆë¸Œ</h3>
             <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <h4 class="text-xl font-bold mb-4 text-brand-primary">ì•„ê¸° ê±´ê°• 3ëŒ€ ìˆ˜ì¹™</h4>
                    <div class="flex justify-around text-center mt-4">
                        <div><div class="text-5xl mb-2">ğŸ’§</div><h5 class="font-bold">ì•ˆì „í•œ ë¬¼</h5></div>
                        <div><div class="text-5xl mb-2">â˜€ï¸</div><h5 class="font-bold">ìì™¸ì„  ì°¨ë‹¨</h5></div>
                        <div><div class="text-5xl mb-2">ğŸ¦Ÿ</div><h5 class="font-bold">ë²Œë ˆ í‡´ì¹˜</h5></div>
                    </div>
                </div>
                 <div class="bg-white p-6 rounded-lg shadow-lg">
                    <h4 class="text-xl font-bold mb-4 text-brand-primary">ì‘ê¸‰ ì˜ë£Œ ì§€ì›</h4>
                    <div class="space-y-4">
                        <div class="bg-red-100 p-3 rounded-lg text-center"><p class="text-red-700 font-semibold">í•„ë¦¬í•€ ê¸´ê¸‰ì „í™”: <span class="font-bold text-2xl ml-2">911</span></p></div>
                        <div class="bg-blue-50 p-3 rounded-lg"><p class="font-bold">ë¦¬ì¡°íŠ¸ ë‚´ ì˜ë£Œ ì§€ì›</p></div>
                        <div class="bg-blue-50 p-3 rounded-lg"><p class="font-bold">ê°€ê¹Œìš´ ë³‘ì›</p></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="itinerary" class="scroll-mt-24">
            <h3 class="text-3xl font-bold text-center mb-2">4ë°• 5ì¼ ì¶”ì²œ ì¼ì •</h3>
            <div id="itinerary-accordion" class="space-y-4"></div>
        </section>
    </main>

    <footer class="bg-brand-dark text-white text-center py-6 mt-12">
        <p>ê°€ì¡±ì˜ ëª¨ë“  ìˆœê°„ì´ í–‰ë³µìœ¼ë¡œ ì±„ì›Œì§€ê¸°ë¥¼ ë°”ëë‹ˆë‹¤.</p>
    </footer>

    <script type="module">
        // --- This script will only run after the entire page is loaded ---
        console.log("[Debug] Page loaded. Starting main script.");

        // --- Static UI Rendering ---
        function renderStaticUI() {
            console.log("[Debug] Starting to render static UI elements.");
            try {
                const tooltipTitleCallback=(i)=>{const t=i[0];let e=t.chart.data.labels[t.dataIndex];return Array.isArray(e)?e.join(" "):e};new Chart(document.getElementById("financeChart").getContext("2d"),{type:"doughnut",data:{labels:["ì‹ ìš©ì¹´ë“œ (ë¦¬ì¡°íŠ¸ ë‚´)","í˜ì†Œ í˜„ê¸ˆ (íŒ/ë°°ë‹¬)"],datasets:[{data:[85,15],backgroundColor:["#3498DB","#5DADE2"],borderColor:"#F8F7F4",borderWidth:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"},tooltip:{callbacks:{title:tooltipTitleCallback}}}}});new Chart(document.getElementById("transportChart").getContext("2d"),{type:"bar",data:{labels:["ë¦¬ì¡°íŠ¸ ì…”í‹€",["í”„ë¼ì´ë¹—","ë¦¬ë¬´ì§„"],"ì¼ë°˜ íƒì‹œ/ê·¸ë©"],datasets:[{label:"ì•ˆì „",data:[9,10,4],backgroundColor:"#2C3E50"},{label:"í¸ì˜ì„±",data:[8,10,7],backgroundColor:"#5DADE2"},{label:"ë¹„ìš© íš¨ìœ¨",data:[7,3,10],backgroundColor:"#E67E22"}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,max:10}},plugins:{legend:{position:"bottom"},tooltip:{callbacks:{title:tooltipTitleCallback}}}}});const e={water:[{t:"ì–´ë¦°ì´ ìˆ˜ì˜ì¥ & ì•„ì¿ ì•„ í”Œë ˆì´",d:"ì•ˆì „í•œ ìˆ˜ì‹¬ê³¼ ê·¸ëŠ˜ë§‰, ì‘ì€ ë¯¸ë„ëŸ¼í‹€ì´ ìˆì–´ ì˜ìœ ì•„ì—ê²Œ ì™„ë²½í•´ìš”."},{t:"í”„ë¼ì´ë¹— ë¹„ì¹˜",d:"íŒŒë„ê°€ ì”ì”í•˜ê³  ëª¨ë˜ë†€ì´ ì¥ë‚œê°ì„ ë¬´ë£Œë¡œ ë¹Œë¦´ ìˆ˜ ìˆì–´ìš”."}],play:[{t:"í† ë“¤ëŸ¬ ì¡´",d:"3ì„¸ ì´í•˜ ì „ìš© ê³µê°„! ë³¼í’€, ë¯¸ë‹ˆ í´ë¼ì´ë° ê¸°êµ¬ê°€ ìˆì–´ìš”."},{t:"ì–´ë“œë²¤ì²˜ ì¡´",d:"ëŒ€í˜• ìŠ¬ë¼ì´ë“œ ì˜† ìœ ì•„ ê³µê°„ì„ ì´ìš©í•˜ì„¸ìš”. (ê¸´íŒ”, ì–‘ë§ í•„ìˆ˜!)"}],experience:[{t:"ë¬¼ê³ ê¸° ë¨¹ì´ ì£¼ê¸°",d:"í•´ë³€ì—ì„œ ì—´ë¦¬ëŠ” ë¬´ë£Œ ì²´í—˜. ì•„ê¸°ì—ê²Œ íŠ¹ë³„í•œ ê²½í—˜ì„ ì„ ë¬¼í•˜ì„¸ìš”."},{t:"ë¯¸ë‹ˆ ê³¨í”„",d:"ì˜¨ ê°€ì¡±ì´ í•¨ê»˜ ì¦ê¸°ëŠ” ê°€ë²¼ìš´ ì•¼ì™¸ í™œë™ì…ë‹ˆë‹¤."}]},t=document.getElementById("activity-cards");for(const[a,l]of Object.entries(e))for(const e of l){const l=document.createElement("div");l.className="activity-card border p-4 rounded-lg",l.dataset.category=a,l.innerHTML=`<h5 class="font-bold">${e.t}</h5><p class="text-sm text-gray-600">${e.d}</p>`,t.appendChild(l)}const a=document.querySelectorAll(".filter-btn");a.forEach(e=>{e.addEventListener("click",()=>{a.forEach(e=>{e.classList.remove("bg-brand-primary","text-white"),e.classList.add("bg-gray-200")}),e.classList.add("bg-brand-primary","text-white"),e.classList.remove("bg-gray-200");const l=e.dataset.filter;document.querySelectorAll("#activity-cards .activity-card").forEach(e=>e.style.display="all"===l||e.dataset.category===l?"block":"none")})}),a[0].click();const l=document.getElementById("tab-resort"),n=document.getElementById("tab-delivery"),r=document.getElementById("content-resort"),o=document.getElementById("content-delivery");r.innerHTML='<h4 class="text-xl font-bold mb-4 text-center">ì•„ê¸°ì™€ í•¨ê»˜ ê°€ê¸° ì¢‹ì€ ë ˆìŠ¤í† ë‘</h4><div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center"><div><h5 class="font-bold text-lg">íƒ€ì´ì¦ˆ (Tides)</h5><p class="text-sm text-gray-600">ì¸í„°ë‚´ì…”ë„ ë·”í˜. ì–´ë¦°ì´ ì „ìš© ì½”ë„ˆì™€ íŒ¬ì¼€ì´í¬ê°€ ì¸ê¸° ë§Œì !</p></div><div><h5 class="font-bold text-lg">ì•„ì¿ ì•„ (Acqua)</h5><p class="text-sm text-gray-600">ì´íƒˆë¦¬ì•ˆ ë ˆìŠ¤í† ë‘. ì¡°ìš©í•œ ë¶„ìœ„ê¸°.</p></div><div><h5 class="font-bold text-lg">ë¶€ì½” ë°” / ë¸Œë¦¬ì¦ˆ</h5><p class="text-sm text-gray-600">ìˆ˜ì˜ì¥ ì˜† ìºì£¼ì–¼ ë‹¤ì´ë‹.</p></div></div>',o.innerHTML='<h4 class="text-xl font-bold mb-4 text-center">ë¦¬ì¡°íŠ¸ë¡œ í•œì‹ê³¼ ë§¥ì£¼ ë°°ë‹¬ì‹œí‚¤ê¸°</h4><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div><h5 class="font-bold mb-2">í•œì‹ ë°°ë‹¬ ì¶”ì²œ</h5><ul class="list-disc list-inside text-gray-700"><li>ë³¸ì´Œ (Bonchon)</li><li>ë¶„ì‹ (Bunsik)</li><li>ë‹¤ì¸ (Da-In)</li></ul></div><div><h5 class="font-bold mb-2">ë§¥ì£¼ & ê°„ì‹ ë°°ë‹¬</h5><ul class="list-disc list-inside text-gray-700"><li>ì•„ì”¨ ì„¸ì‹œ í•œì¸ë§ˆíŠ¸</li><li>ë¡œë¹ˆìŠ¨ ìŠˆí¼ë§ˆì¼“</li></ul></div></div><div class="mt-6 bg-green-100 border-l-4 border-green-500 text-green-700 p-4 rounded text-center"><p class="font-extrabold text-lg">â­ï¸ ìµœê³ ì˜ ê¿€íŒ! â­ï¸</p><p>ì¹´ì¹´ì˜¤í†¡ ID: <span class="font-mono bg-white px-2 py-1 rounded-md">pusanmart</span></p></div>';function c(e,t,a,l){e.classList.add("active","text-brand-primary"),e.classList.remove("text-gray-500"),t.classList.remove("active","text-brand-primary"),t.classList.add("text-gray-500"),a.classList.remove("hidden"),l.classList.add("hidden")}c(l,n,r,o),l.addEventListener("click",()=>c(l,n,r,o)),n.addEventListener("click",()=>c(n,l,o,r));const i=document.getElementById("itinerary-accordion"),d=[{day:1,title:"ë„ì°© ë° ë¦¬ì¡°íŠ¸ ì ì‘",details:["ê³µí•­ ë„ì°© í›„ ë¦¬ì¡°íŠ¸ ì…”í‹€ë¡œ ì´ë™","ì ì‹¬ ì‹ì‚¬ í›„ ìˆ˜ì˜ì¥ì—ì„œ íœ´ì‹","í•´ë³€ì—ì„œ ì¼ëª° ê°ìƒ"]},{day:2,title:"ë¬¼ë†€ì´ì˜ ì„¸ê³„",details:["ì–´ë¦°ì´ ìˆ˜ì˜ì¥ & ì•„ì¿ ì•„ í”Œë ˆì´","ì•„ê¸° ë‚®ì , ë¶€ëª¨ë‹˜ íœ´ì‹","ë² ì´ë¹„ì‹œí„° ì„œë¹„ìŠ¤ ì´ìš© í›„ ì €ë… ì‹ì‚¬"]},{day:3,title:"ë°”ë‹¤ì™€ ìœ¡ì§€ íƒí—˜",details:["ë¬¼ê³ ê¸° ë¨¹ì´ì£¼ê¸° & ëª¨ë˜ë†€ì´","ì•„ê¸°ì™€ í† ë“¤ëŸ¬ ì¡´ ë°©ë¬¸","ë°°ë‹¬ ìŒì‹ìœ¼ë¡œ í¸ì•ˆí•œ ì €ë…"]},{day:4,title:"ë†€ì´ì™€ íœ´ì‹",details:["ì–´ë“œë²¤ì²˜ ì¡´ ë°©ë¬¸ í›„ ë¯¸ë‹ˆ ê³¨í”„","ë©”ì¸ ìˆ˜ì˜ì¥ì—ì„œ ë§ˆì§€ë§‰ ë¬¼ë†€ì´","ê¸°ë… ì €ë… ì‹ì‚¬"]},{day:5,title:"ì•ˆë…•, ì„¸ë¶€!",details:["ì—¬ìœ ë¡œìš´ ë§ˆì§€ë§‰ ì•„ì¹¨ ì‹ì‚¬","ì²´í¬ì•„ì›ƒ í›„ ê³µí•­ ì´ë™"]}];for(const e of d){const t=document.createElement("div");t.className="bg-white rounded-lg shadow-lg overflow-hidden",t.innerHTML=`<button class="accordion-header w-full p-4 text-left font-bold text-lg bg-brand-light flex justify-between items-center"><span>${e.day}ì¼ì°¨: ${e.title}</span><span class="transform transition-transform duration-300">â–¼</span></button><div class="accordion-content p-4 border-t hidden">${e.details.map(e=>`<p>â€¢ ${e}</p>`).join("")}</div>`,i.appendChild(t)}document.querySelectorAll(".accordion-header").forEach(e=>{e.addEventListener("click",()=>{e.nextElementSibling.classList.toggle("hidden"),e.querySelector("span:last-child").classList.toggle("rotate-180")})});const s=document.querySelectorAll("section"),m=document.querySelectorAll("#main-nav a");window.addEventListener("scroll",()=>{let e="";s.forEach(t=>{pageYOffset>=t.offsetTop-120&&(e=t.getAttribute("id"))}),m.forEach(t=>{t.classList.remove("active"),t.getAttribute("href").includes(e)&&t.classList.add("active")})});
                console.log("[Debug] Static UI rendering complete.");
            } catch (error) {
                console.error("[Debug] Error rendering static UI:", error);
            }
        }
        
        // --- Firebase Logic Function ---
        async function initFirebase() {
            console.log("[Debug] Attempting to initialize Firebase.");
            const { initializeApp } = await import("https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js");
            const { getFirestore, doc, getDoc, setDoc, onSnapshot, collection, addDoc, serverTimestamp } = await import("https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js");
            const { getAuth, signInAnonymously, onAuthStateChanged } = await import("https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js");

            const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-cebu-trip-app';
            let db, auth, tripDocRef, unsubscribe;

            const checklistData = { 'ì„œë¥˜ & ê¸ˆì „': {'passport':'ì—¬ê¶Œ & í•­ê³µê¶Œ','etravel':'eTravel QRì½”ë“œ','money':'ì‹ ìš©ì¹´ë“œ & í˜ì†Œ í˜„ê¸ˆ'},'ì•„ê¸° í•„ìˆ˜í’ˆ':{'diapers':'ê¸°ì €ê·€ (ë°©ìˆ˜/ì¼ë°˜)','rashguard':'ê¸´íŒ” ë˜ì‰¬ê°€ë“œ & ëª¨ì','clothes':'ê¸´íŒ”ì˜·/ì–‘ë§ (ì–´ë“œë²¤ì²˜ì¡´)','toys':'ì• ì°©ìš©í’ˆ & ë¹„ìƒê°„ì‹'},'ê±´ê°• & ì•ˆì „':{'sunscreen':'ìœ ì•„ìš© ì„ í¬ë¦¼','repellent':'ë²Œë ˆ í‡´ì¹˜ì œ (í•„ìˆ˜)','meds':'ìƒë¹„ì•½ (í•´ì—´ì œ ë“±)'}};
            const defaultChecklistState = {passport:false,etravel:false,money:false,diapers:false,rashguard:false,clothes:false,toys:false,sunscreen:false,repellent:false,meds:false};

            function displayFirebaseError(message) {
                console.error(`[Debug] Firebase Error: ${message}`);
                const errorMsg = `<p class="text-red-500 font-semibold">${message}</p>`;
                document.getElementById('share-loader').innerHTML = errorMsg;
                document.getElementById('checklist-loader').innerHTML = errorMsg;
            }

            if (!firebaseConfig || Object.keys(firebaseConfig).length === 0) {
                displayFirebaseError("ê³µìœ  ê¸°ëŠ¥ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì´ ê¸°ëŠ¥ì€ íŠ¹ì • í™˜ê²½ì—ì„œë§Œ ì§€ì›ë©ë‹ˆë‹¤.");
                return;

            console.log("[Debug] Firebase config found. Initializing app...");
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                console.log("[Debug] Signing in anonymously...");
                await signInAnonymously(auth);
                onAuthStateChanged(auth, user => {
                    if (user) { 
                        console.log("[Debug] Auth state changed, user is signed in:", user.uid);
                        handleTripSession(); 
                    } else { 
                        displayFirebaseError("ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”."); 
                    }
                });
            } catch (error) {
                displayFirebaseError(`ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
            }

            async function handleTripSession() {
                console.log("[Debug] Handling trip session...");
                const params = new URLSearchParams(window.location.search);
                let tripId = params.get('tripId');
                const collectionPath = `artifacts/${appId}/public/data/cebu-trip-checklists`;
                try {
                    let isNewUrl = false;
                    if (tripId) {
                        console.log(`[Debug] Existing tripId found: ${tripId}`);
                        tripDocRef = doc(db, collectionPath, tripId);
                    } else {
                        isNewUrl = true;
                        console.log("[Debug] No tripId found, creating new trip document...");
                        const newDocRef = await addDoc(collection(db, collectionPath), { createdAt: serverTimestamp(), checklist: defaultChecklistState });
                        tripId = newDocRef.id;
                        console.log(`[Debug] New trip document created with id: ${tripId}`);
                        tripDocRef = newDocRef;
                    }
                    
                    if(isNewUrl) {
                         try {
                            // This might fail in sandboxed environments, so we wrap it.
                            history.replaceState({}, 'Cebu Trip', `?tripId=${tripId}`);
                            document.getElementById('share-url').value = window.location.href;
                            document.getElementById('share-content').classList.remove('hidden');
                         } catch (e) {
                            console.warn("[Debug] history.replaceState failed. This is expected in some sandboxed environments.", e);
                            document.getElementById('share-fallback').classList.remove('hidden');
                            document.getElementById('fallback-trip-id').textContent = tripId;
                         }
                    } else {
                        document.getElementById('share-url').value = window.location.href;
                        document.getElementById('share-content').classList.remove('hidden');
                    }
                    
                    document.getElementById('share-loader').classList.add('hidden');

                    if (unsubscribe) unsubscribe();
                    console.log("[Debug] Setting up Firestore onSnapshot listener.");
                    unsubscribe = onSnapshot(tripDocRef, (docSnap) => {
                        console.log("[Debug] onSnapshot fired.");
                        if (docSnap.exists()) {
                            console.log("[Debug] Document data:", docSnap.data());
                            renderChecklist(docSnap.data().checklist);
                        } else {
                             console.log("[Debug] Document does not exist, creating with default state.");
                            setDoc(tripDocRef, { createdAt: serverTimestamp(), checklist: defaultChecklistState });
                        }
                    }, error => {
                        displayFirebaseError(`ë°ì´í„° ë™ê¸°í™” ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
                    });
                } catch (error) {
                     displayFirebaseError(`ì—¬í–‰ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.message}`);
                }
            }
        
            function renderChecklist(data) {
                console.log("[Debug] Rendering checklist with data:", data);
                const container = document.getElementById('checklist-container');
                container.innerHTML = '';
                for (const category in checklistData) {
                    const categoryDiv = document.createElement('div');
                    categoryDiv.innerHTML = `<h5 class="font-bold text-lg mb-3">${category}</h5>`;
                    const ul = document.createElement('ul');
                    ul.className = 'space-y-2';
                    for (const itemId in checklistData[category]) {
                        const itemText = checklistData[category][itemId];
                        const isChecked = data ? data[itemId] || false : false;
                        const li = document.createElement('li');
                        li.className = `checklist-item flex items-center ${isChecked ? 'checked' : ''}`;
                        li.innerHTML = `<input type="checkbox" id="${itemId}" data-id="${itemId}" class="h-4 w-4 mr-2" ${isChecked ? 'checked' : ''}><label for="${itemId}" class="cursor-pointer">${itemText}</label>`;
                        ul.appendChild(li);
                    }
                    categoryDiv.appendChild(ul);
                    container.appendChild(categoryDiv);
                }
                document.querySelectorAll('#checklist-container input[type="checkbox"]').forEach(checkbox => {
                    checkbox.addEventListener('change', (e) => updateChecklistInFirestore(e.target.dataset.id, e.target.checked));
                });
            }

            async function updateChecklistInFirestore(itemId, isChecked) {
                if (!tripDocRef) return;
                console.log(`[Debug] Updating Firestore: ${itemId} -> ${isChecked}`);
                try {
                    await setDoc(tripDocRef, { checklist: { [itemId]: isChecked } }, { merge: true });
                } catch (error) { console.error("Error updating checklist: ", error); }
            }
        
            document.getElementById('copy-url-btn').addEventListener('click', () => {
                const urlInput = document.getElementById('share-url');
                urlInput.select();
                document.execCommand('copy');
                const feedback = document.getElementById('copy-feedback');
                feedback.textContent = 'ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!';
                setTimeout(() => { feedback.textContent = ''; }, 2000);
            });
            
            document.getElementById('fallback-trip-id').addEventListener('click', (e) => {
                const textToCopy = e.target.textContent;
                navigator.clipboard.writeText(textToCopy).then(() => {
                    const feedback = document.getElementById('fallback-copy-feedback');
                    feedback.textContent = 'IDê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!';
                    setTimeout(() => { feedback.textContent = ''; }, 2000);
                });
            });
        }
    
        // --- Initial Load ---
        // This ensures static UI is drawn first, then Firebase is initialized.
        document.addEventListener('DOMContentLoaded', () => {
            renderStaticUI();
            initFirebase();
        });
    </script>
</body>
</html>
